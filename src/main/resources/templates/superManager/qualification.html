<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Profile - Brand</title>
    <link rel="stylesheet" th:href="@{/bootstrap/css/bootstrap.min.css}">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Kaushan+Script">
    <link rel="stylesheet" th:href="@{/fonts/fontawesome-all.min.css}">
    <link rel="stylesheet" th:href="@{/fonts/font-awesome.min.css}">
    <link rel="stylesheet" th:href="@{/fonts/fontawesome5-overrides.min.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/baguettebox.js/1.10.0/baguetteBox.min.css">
    <link rel="stylesheet" th:href="@{/css/Off-Canvas-Sidebar-Drawer-Navbar.css}">
    <link rel="stylesheet" th:href="@{/css/Pretty-Search-Form.css}">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/css/Table-With-Search-1.css}">
    <link rel="stylesheet" th:href="@{/css/Table-With-Search.css}">
    <link rel="stylesheet" th:href="@{/css/vanilla-zoom.min.css}">
    <!-- 以下兩行為csrf設定 https://blog.csdn.net/Dongguabai/article/details/81150989 -->
    <meta name="_csrf" th:content="${_csrf.token}" />
    <meta name="_csrf_header" th:content="${_csrf.headerName}" />
</head>

<body id="page-top">
    <div id="wrapper">
        <div class="d-flex flex-column" id="content-wrapper">
            <div id="content" style="margin-top: 15%;margin-left: 10%;width: 80%;">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 col-sm-12">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="#"><span>SuperManger</span></a></li>
                                <li class="breadcrumb-item"><a href="#"><span>權限管理</span></a></li>
                            </ol>
                        </div>
                    </div>
                    <div class="col-md-12 col-xxl-12 offset-xxl-0 search-table-col">
                        <div class="form-group pull-left col-lg-3">
                            <input type="text" class="search form-control" id="keyWord"
                                   placeholder="請輸入管理員相關資料">
                        </div><span class="counter"></span><span class="counter"></span><label class="form-label" style="margin-top: 8px;">管理員狀態:&nbsp;</label>
                        <select id="level">
                            <optgroup label="This is a group">
                                <option value="" selected="">請選擇</option>
                                <option value="MANAGER">管理員</option>
                                <option value="SUPER_MANAGER">超級管理員</option>
                            </optgroup>
                        </select>
                        <button class="btn btn-success" id="findAdmin">查詢</button>
                        <div class="table-responsive table table-hover table-bordered results">
                            <table class="table table-hover table-bordered">
                                <thead class="bill-header cs">
                                    <tr>
                                        <th id="trs-hd" class="col-lg-1">管理員編號</th>
                                        <th id="trs-hd" class="col-lg-1">帳號</th>
                                        <th id="trs-hd" class="col-lg-1">姓名</th>
                                        <th id="trs-hd" class="col-lg-1">手機</th>
                                        <th id="trs-hd-2" class="col-lg-2">地址</th>
                                        <th id="trs-hd" class="col-lg-1">等級</th>
                                        <th id="trs-hd" class="col-lg-1">功能權限</th>
                                        <th id="trs-hd" class="col-lg-1">Action</th>
                                    </tr>
                                </thead>
                                <tbody id = "admin_tbody">
                                    <tr class="warning no-result">
                                        <td colspan="12"><i class="fa fa-warning"></i>&nbsp; No Result !!!</td>
                                    </tr>
                                    <tr class="admin-result-tr">
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td>
                                            <a href="" class="btn btn-info btn-sm">修改</a>
                                            <a href="" class="btn btn-danger btn-sm">移除</a>
                                        </td>
                                    </tr>

                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
    		<div th:replace="block/footer::footer-bottom"></div>
        </div><a class="border rounded d-inline scroll-to-top" href="#page-top"><i class="fas fa-angle-up"></i></a>
    </div>

    <div th:replace="block/navbar::nav-header"></div>
    
    <script th:src="@{/bootstrap/js/bootstrap.min.js}"></script>
    <script th:src="@{/js/Off-Canvas-Sidebar-Drawer-Navbar.js}"></script>
    <script th:src="@{/js/agency.js}"></script>
    <script th:src="@{/js/Off-Canvas-Sidebar-Drawer-Navbar-1.js}"></script>
    <script th:src="@{/js/Table-With-Search.js}"></script>
    <script th:src="@{/js/theme.js}"></script>
    <script src="https://code.jquery.com/jquery.js"></script>
    <script type="text/javascript" th:inline="javascript">

        /*<![CDATA[*/
        var header = $("meta[name='_csrf_header']").attr("content");
        var token = $("meta[name='_csrf']").attr("content");

        initAdmin();
        ajaxFindAdmin();

        function initAdmin(){
            document.getElementsByClassName("admin-result-tr")[0].style.display='none';
        }

        function findAdmin(){
            var inputKeyWord = document.getElementById("keyWord").value;
            var inputLevel = document.getElementById("level").value;
            if(inputLevel==""){
                inputLevel = null;
            }
            ajaxFindAdmin(inputKeyWord, inputLevel);
        }

        function ajaxFindAdmin(inputKeyWord, inputLevel){
            const ajaxTargetUri = window.location.href.substring(0, window.location.href.lastIndexOf
            ('/view')) + '/api/administrator/find';

            $.ajax({
                type: 'POST',
                url: ajaxTargetUri,
                headers: {
                    'X-CSRF-TOKEN': token
                },
                data: JSON.stringify({
                    keyWord: inputKeyWord,
                    level: inputLevel
                }),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (result) {
                    alert(result);
                    showResult(result);
                },
                error: function (result) {
                    alert("Fail");
                }
            });
        }

        function showResult(result){

            for (let i = 0; i<result.length ; i++) {
                var adminResultTr = document.getElementsByClassName("admin-result-tr")[0].cloneNode(true);
                adminResultTr.style.display=null;
                adminResultTr.childNodes[1].textContent = result[i].admNo;
                adminResultTr.childNodes[3].textContent = result[i].userName;
                adminResultTr.childNodes[5].textContent = result[i].name;
                adminResultTr.childNodes[7].textContent = result[i].phone;
                adminResultTr.childNodes[9].textContent = result[i].address;
                adminResultTr.childNodes[11].textContent = result[i].level;

                var start_tbody = document.getElementById("admin_tbody");
                start_tbody.insertBefore(adminResultTr, start_tbody.childNodes[1+i]);
            }


        }

        window.addEventListener("load", function () {
            document.getElementById("findAdmin").onclick = findAdmin;
        },false);

        /*]]>*/
    </script>

</body>

</html>